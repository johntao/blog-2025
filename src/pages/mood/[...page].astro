---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths = (async ({ paginate }) => {
  const allMoods = await getCollection('mood-tracker');
  const sortedMoods = allMoods.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

  return paginate(sortedMoods, { pageSize: 50 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
---

<BaseLayout title="Mood Tracker" cls="list1">
  <h2>Mood Tracker</h2>
  <p>Short reviews on random topics: games, podcasts, movies, events...</p>
  <hr />

  {page.data.map((mood, index) => (
    <>
      <article>
        <h3>
          <!-- <strong></strong> -->
          {mood.data.pubDate.toLocaleDateString('en-US', { month: '2-digit', day: '2-digit' })}
          {mood.data.title}
        </h3>
        <pre class="mood-content" set:html={mood.body} />
      </article>

      {index < page.data.length - 1 && <hr />}
    </>
  ))}

  {(page.url.prev || page.url.next) && (
    <nav class="pagination">
      {page.url.prev && <a href={page.url.prev}>← Newer</a>}
      <span>Page {page.currentPage} of {page.lastPage}</span>
      {page.url.next && <a href={page.url.next}>Older →</a>}
    </nav>
  )}
</BaseLayout>

<style>
  .mood-content {
    text-wrap: stable;
    color: var(--color-white-l4);
  }

  .pagination {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid var(--color-border, #404040);
  }
</style>
