---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths = (async ({ paginate }) => {
  const allMoods = await getCollection('mood-tracker');
  const sortedMoods = allMoods.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

  return paginate(sortedMoods, { pageSize: 50 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
---

<BaseLayout title="Mood Tracker" cls="list1">
  <h2>Mood Tracker</h2>
  <p>Short reviews on random topics: games, podcasts, movies, events...</p>
  <hr />

  {page.data.map(async (mood, index) => {
    const { Content } = await mood.render();
    return (
      <>
        <article>
          <h3>
            {mood.data.pubDate.toLocaleDateString('en-US', { month: '2-digit', day: '2-digit' })}
            {mood.data.title}
          </h3>
          <Content />
        </article>
        {index < page.data.length - 1 && <hr />}
      </>
    );
  })}

  {(page.url.prev || page.url.next) && (
    <nav class="pagination">
      {page.url.prev && <a href={page.url.prev}>← Newer</a>}
      <span>Page {page.currentPage} of {page.lastPage}</span>
      {page.url.next && <a href={page.url.next}>Older →</a>}
    </nav>
  )}
</BaseLayout>

<style>
  /* .mood-content :global(p) { */
  /*   margin: 0.5rem 0; */
  /* } */
  /**/
  /* .mood-content :global(a) { */
  /*   color: var(--color-hyprlink, #75bfff); */
  /*   text-decoration: underline; */
  /* } */
  /**/
  /* .mood-content :global(a:hover) { */
  /*   opacity: 0.8; */
  /* } */
  /**/
  /* .mood-content :global(ul), */
  /* .mood-content :global(ol) { */
  /*   margin: 0.5rem 0; */
  /*   padding-left: 1.5rem; */
  /* } */
  /**/
  /* .mood-content :global(strong) { */
  /*   font-weight: bold; */
  /* } */
  /**/
  /* .mood-content :global(em) { */
  /*   font-style: italic; */
  /* } */
  /**/
  /* .mood-content :global(code) { */
  /*   background-color: var(--color-bg-code, rgba(255, 255, 255, 0.1)); */
  /*   padding: 0.1rem 0.3rem; */
  /*   border-radius: 3px; */
  /*   font-family: monospace; */
  /* } */
  /**/
  /* .mood-content :global(pre) { */
  /*   background-color: var(--color-bg-code, rgba(255, 255, 255, 0.1)); */
  /*   padding: 1rem; */
  /*   border-radius: 5px; */
  /*   overflow-x: auto; */
  /* } */
  /**/
  /* .mood-content :global(pre code) { */
  /*   background-color: transparent; */
  /*   padding: 0; */
  /* } */

  .pagination {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid var(--color-border, #404040);
  }
</style>
