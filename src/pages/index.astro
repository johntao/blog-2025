---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Fetch posts from all author collections
const author1Posts = await getCollection('author1');
const author2Posts = await getCollection('author2');
const author3Posts = await getCollection('author3');

// Combine all posts and get recent 3
const allPosts = [...author1Posts, ...author2Posts, ...author3Posts];
const recentPosts = allPosts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<BaseLayout title="JT's Weblog">
  <h2>Recent Posts</h2>

  {recentPosts.map((post, index) => (
    <>
      <article>
        <h3><a href={`/posts/${post.slug}`}>{post.data.title}</a></h3>
        <p><em>Published: {post.data.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</em></p>
        <p>{post.data.description}</p>
      </article>

      {index < recentPosts.length - 1 && <hr />}
    </>
  ))}
</BaseLayout>
